#!/bin/bash

########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################

#PBS -m abe

#PBS -V

#PBS -l nodes=1:ppn=24:cluster-Cerrado,walltime=999:00:00

################ Where:
################ nodes = number of nodes requested
################ ppn = number of cores per node
################ cluster-Cerrado = cluster name
################ walltime = max allocation time

#PBS -M gabriell.araujo@acad.pucrs.br

#PBS -r n

#PBS -j oe

#PBS -d /home/gabriell.araujo/

echo Running on host `hostname`
echo
echo Initial Time is `date`
echo
echo Directory is `pwd`
echo
echo This jobs runs on the following nodes:
echo `cat $PBS_NODEFILE | uniq`
echo
echo JOB_ID:
echo `echo $PBS_JOBID`

########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################

#######################
#compile
#######################
make clean
mkdir logs
clear
make

#######################
#run serial
#######################
for ((j=0;j<10;j++))
do
	./run_lane_detection_seq auto.mp4 >> logs/log_seq.txt
done

#######################
#run pthread
#######################
for ((i=1;i<=24;i++))
do
	for ((j=0;j<10;j++))
	do
		./run_lane_detection_pthread auto.mp4 $i >> logs/log_pthread_cores_$i.txt
	done
done

#######################
#run openmp v1
#######################
for ((i=1;i<=24;i++))
do
	for ((j=0;j<10;j++))
	do
		./run_lane_detection_openmp_v1 auto.mp4 $i >> logs/log_openmp_v1_cores_$i.txt
	done
done

#######################
#run openmp v2
#######################
for ((i=1;i<=24;i++))
do
	for ((j=0;j<10;j++))
	do
		./run_lane_detection_openmp_v2 auto.mp4 $i >> logs/log_openmp_v2_cores_$i.txt
	done
done

#######################
#run openmp v3
#######################
for ((i=1;i<=24;i++))
do
	for ((j=0;j<10;j++))
	do
		./run_lane_detection_openmp_v3 auto.mp4 $i >> logs/log_openmp_v3_cores_$i.txt
	done
done

########################################################################################################################
########################################################################################################################
########################################################################################################################
########################################################################################################################

echo Final Time is `date`
